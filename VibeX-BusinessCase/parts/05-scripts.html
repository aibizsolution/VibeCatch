</main>

<div id="slide-overlay" class="fixed inset-0 z-50 hidden bg-slate-950/95 text-white" role="dialog" aria-modal="true" aria-labelledby="slide-title">
  <div class="relative h-full w-full">
    <div class="absolute left-4 top-4 flex items-center gap-3 text-xs text-white/70 md:text-sm">
      <span id="slide-counter" class="rounded-full border border-white/20 bg-white/10 px-3 py-1 text-white/90">1 / 11</span>
      <span class="hidden h-4 w-px bg-white/30 md:block"></span>
      <span id="slide-title" class="hidden font-semibold text-white/90 md:block">슬라이드</span>
    </div>
    <div class="absolute right-4 top-4 flex items-center gap-2">
      <button id="slide-prev" type="button" class="rounded-full border border-white/20 bg-white/10 px-4 py-2 text-xs font-semibold text-white/90 transition hover:bg-white/20">이전</button>
      <button id="slide-next" type="button" class="rounded-full border border-white/20 bg-white/10 px-4 py-2 text-xs font-semibold text-white/90 transition hover:bg-white/20">다음</button>
      <button id="slide-close" type="button" class="rounded-full border border-white/20 bg-white/10 px-4 py-2 text-xs font-semibold text-white/90 transition hover:bg-white/20">발표 종료</button>
    </div>
    <div class="flex h-full w-full items-center justify-center px-5 py-8 md:px-12 md:py-10">
      <div class="relative h-full w-full max-w-6xl max-h-[calc(100vh-12rem)] overflow-hidden rounded-3xl border border-white/10 bg-slate-900/40 shadow-2xl">
        <div id="slide-container" class="flex h-full w-full items-center justify-center"></div>
      </div>
    </div>
  </div>
</div>

<script>
  (() => {
    const openButton = document.getElementById('open-slide-deck');
    const overlay = document.getElementById('slide-overlay');
    const slideContainer = document.getElementById('slide-container');
    const slideTitle = document.getElementById('slide-title');
    const slideCounter = document.getElementById('slide-counter');
    const prevButton = document.getElementById('slide-prev');
    const nextButton = document.getElementById('slide-next');
    const closeButton = document.getElementById('slide-close');

    if (!openButton || !overlay || !slideContainer || !slideCounter || !prevButton || !nextButton || !closeButton) {
      return;
    }

    const createHeading = (text) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'mb-6';
      const heading = document.createElement('h2');
      heading.className = 'text-2xl font-semibold text-white md:text-3xl';
      heading.textContent = text;
      wrapper.appendChild(heading);
      return wrapper;
    };

    const makeSlide = (title, nodes) => {
      const viewport = document.createElement('div');
      viewport.className = 'w-full max-h-full overflow-y-auto px-6 py-6 md:px-10 md:py-8';
      const inner = document.createElement('div');
      inner.className = 'mx-auto max-w-6xl';
      nodes.forEach((node) => {
        if (node) {
          inner.appendChild(node);
        }
      });
      viewport.appendChild(inner);
      return { title, content: viewport };
    };

    const clone = (selector) => {
      const element = document.querySelector(selector);
      return element ? element.cloneNode(true) : null;
    };

    const buildSlides = () => {
      const slides = [];
      const hero = clone('main > section:first-of-type');
      if (hero) {
        const heroButton = hero.querySelector('#open-slide-deck');
        if (heroButton) {
          heroButton.remove();
        }
        slides.push(makeSlide('VibeX 사업화 추진안', [hero]));
      }

      const summary = clone('#summary');
      if (summary) {
        slides.push(makeSlide('핵심 요약', [summary]));
      }

      const gap = clone('#gap');
      if (gap) {
        slides.push(makeSlide('시장 공백', [gap]));
      }

      const category = clone('#category');
      if (category) {
        slides.push(makeSlide('전략 분류', [category]));
      }

      const competitorCards = Array.from(document.querySelectorAll('#competitors .mt-8.space-y-8 > div'));
      competitorCards.forEach((card) => {
        const name = card.querySelector('.text-2xl')?.textContent?.trim();
        const title = name ? `경쟁사 상세 분석 · ${name}` : '경쟁사 상세 분석';
        slides.push(makeSlide(title, [createHeading(title), card.cloneNode(true)]));
      });

      const model = clone('#model');
      if (model) {
        slides.push(makeSlide('수익 모델', [model]));
      }

      const roadmap = clone('#roadmap');
      if (roadmap) {
        slides.push(makeSlide('로드맵', [roadmap]));
      }

      const appendixWrap = document.querySelector('#appendix > div');
      if (appendixWrap) {
        const children = Array.from(appendixWrap.children);
        const splitIndex = children.findIndex((child) => child.classList.contains('mt-12'));
        const firstPart = splitIndex > 0 ? children.slice(0, splitIndex) : children;
        const secondPart = splitIndex > 0 ? children.slice(splitIndex) : [];

        if (firstPart.length) {
          slides.push(makeSlide('부록 ① 요금 체계 비교', firstPart.map((node) => node.cloneNode(true))));
        }
        if (secondPart.length) {
          slides.push(makeSlide('부록 ② 서비스 주요 포인트 비교', secondPart.map((node) => node.cloneNode(true))));
        }
      }

      return slides;
    };

    let slides = [];
    let index = 0;

    const render = () => {
      const slide = slides[index];
      if (!slide) {
        return;
      }
      slideContainer.innerHTML = '';
      slideContainer.appendChild(slide.content);
      slideCounter.textContent = `${index + 1} / ${slides.length}`;
      if (slideTitle) {
        slideTitle.textContent = slide.title;
      }

      const isFirst = index === 0;
      const isLast = index === slides.length - 1;
      prevButton.disabled = isFirst;
      nextButton.disabled = isLast;
      prevButton.classList.toggle('opacity-40', isFirst);
      prevButton.classList.toggle('cursor-not-allowed', isFirst);
      nextButton.classList.toggle('opacity-40', isLast);
      nextButton.classList.toggle('cursor-not-allowed', isLast);
    };

    const open = () => {
      slides = buildSlides();
      index = 0;
      overlay.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
      render();
    };

    const close = () => {
      overlay.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    };

    const next = () => {
      if (index < slides.length - 1) {
        index += 1;
        render();
      }
    };

    const prev = () => {
      if (index > 0) {
        index -= 1;
        render();
      }
    };

    openButton.addEventListener('click', open);
    closeButton.addEventListener('click', close);
    nextButton.addEventListener('click', next);
    prevButton.addEventListener('click', prev);

    overlay.addEventListener('click', (event) => {
      if (event.target === overlay) {
        close();
      }
    });

    document.addEventListener('keydown', (event) => {
      if (overlay.classList.contains('hidden')) {
        return;
      }
      if (event.key === 'Escape') {
        close();
      }
      if (event.key === 'ArrowRight') {
        next();
      }
      if (event.key === 'ArrowLeft') {
        prev();
      }
    });
  })();
</script>
</body>
